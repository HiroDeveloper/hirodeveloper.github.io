<!DOCTYPE html>
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="preconnect" href="https://fonts.gstatic.com/">
    <link rel="preconnect" href="https://fonts.googleapis.com/"> 
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin=""> 
	<link rel="shortcut icon" href="https://panel.holy.gg/favicons/favicon.ico">
    <link href="./min.css" rel="stylesheet">
    <meta name="theme-color" content="#000000">
  </head> 

<body class="default ">
<section class="container container--med padd-xs">
    <hr>
  <div class="row-mobile padd-m">
    <div class="col med">NA - Virginia: <span class="ping" id="virginia_ping"></span></div>
    <code>va1.holy.gg</code>
  </div>
  <div class="row-mobile padd-m">
    <div class="col med">NA - Oregon: <span class="ping" id="oregon_ping"></span></div>
    <code>or1.holy.gg</code>
  </div>
    <hr>
  <div class="row-mobile padd-m">
    <div class="col med">EU - Falkenstein: <span class="ping" id="falkenstein_ping"></span></div>
    <code>de2.holy.gg</code>
  </div>
  <hr>
  <div class="row-mobile padd-m">
    <div class="col med">Node Jujuy: <span class="ping" id="santiago_ping"></span></div>
    <code>ws://ping.black-ice.net:36273</code>
  </div>
  <hr>
</section>
<script>
  function pingWebsocket(url, element) {
    const socket = new WebSocket(url);

    let sendTime;
    let averageTimeList = [];
    let averageTime = 0;
    let interval;
    socket.onopen = () => {
      interval = setInterval(() => {
        socket.send("ping");
        sendTime = performance.now();
      }, 500);

      clearTimeout(timeout);
    };

    // socket timeout
    let timeout = setTimeout(() => {
      socket.onerror(undefined);
    }, 10000);

    socket.onmessage = (_) => {
      averageTimeList.push(performance.now() - sendTime - .5);
      if (averageTimeList.length > 5) {
        averageTimeList.shift();
        averageTime = Math.round(averageTimeList.reduce((p, c) => p + c) / 5);
        element.innerHTML = `${averageTime}ms`;
      }
    };

    socket.onclose = socket.onerror = () => {
      clearInterval(interval);
      element.classList.remove("ping");
      element.classList.add("ping-two");
      element.innerHTML = "Error."
    };
  }

  pingWebsocket("wss://ping-us-1.holy.gg/ping", document.querySelector("#virginia_ping"));
  pingWebsocket("wss://ping-us-2.holy.gg/ping", document.querySelector("#oregon_ping"));
  pingWebsocket("wss://ping-eu-1.holy.gg/ping", document.querySelector("#falkenstein_ping"));
  pingWebsocket("wss://ping.black-ice.net:36273", document.querySelector("#santiago_ping"));
  
</script>
</body></html>
